<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Mahasiswa</title>
    <style>
        :root {
            --bg-color: #f7f7f5;
            --text-color: #111111;
            --muted-text: #666666;
            --table-border: #e5e5e5;
            --table-header-bg: #f0f0ee;
            --button-bg: #1b8301;
            --button-hover: #222222;
            --error-color: #ff6b6b;
            --card-bg: #ffffff;
            --focus-ring: #111111;
        }

        [data-theme="dark"] {
            --bg-color: #0f0f0f;
            --text-color: #f5f5f5;
            --muted-text: #b3b3b3;
            --table-border: #2a2a2a;
            --table-header-bg: #1a1a1a;
            --button-bg: #f5f5f5;
            --button-hover: #dddddd;
            --error-color: #ff6b6b;
            --card-bg: #151515;
            --focus-ring: #f5f5f5;
        }

        body {
            font-family: "Palatino Linotype", "Book Antiqua", Palatino, serif;
            margin: 32px auto;
            padding: 0 16px;
            max-width: 1000px;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        h1, h2 {
            color: var(--text-color);
            letter-spacing: 0.2px;
            margin: 0 0 12px 0;
        }

        form { margin-bottom: 18px; }

        input {
            margin: 6px 6px 6px 0;
            padding: 10px 12px;
            background-color: var(--card-bg);
            color: var(--text-color);
            border: 1px solid var(--table-border);
            border-radius: 6px;
            outline: none;
        }

        input:focus {
            border-color: var(--focus-ring);
            box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.08);
        }

        button {
            padding: 10px 14px;
            background: var(--button-bg);
            color: var(--bg-color);
            border: 1px solid var(--button-bg);
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }

        button:hover {
            background: var(--button-hover);
            border-color: var(--button-hover);
        }

        a {
            color: var(--text-color);
            text-decoration: none;
            border-bottom: 1px solid var(--table-border);
        }

        a:hover { border-bottom-color: var(--text-color); }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--card-bg);
            border: 1px solid var(--table-border);
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            border-bottom: 1px solid var(--table-border);
            padding: 10px 12px;
            text-align: left;
            color: var(--text-color);
        }

        th { background-color: var(--table-header-bg); font-weight: 600; }
        tr:last-child td { border-bottom: none; }

        /* Styling untuk kolom yang sedang di-sort */
        .sorted-column {
            background-color: var(--table-header-bg);
            font-weight: 600;
        }

        .error { color: var(--error-color); }

        .success {
            color: var(--text-color);
            border: 1px solid #85e785;
            padding: 10px 12px;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        .theme-toggle,
        .lang-toggle {
            position: fixed;
            top: 20px;
            padding: 8px;
            background: var(--card-bg);
            color: var(--text-color);
            border: 1px solid var(--table-border);
            border-radius: 50%;
            cursor: pointer;
            width: 40px;
            height: 40px;
            font-size: 16px;
            transition: background-color 0.2s, border-color 0.2s;
        }

        .theme-toggle { right: 20px; }
        .lang-toggle { right: 70px; font-size: 12px; font-weight: 600; }

        .theme-toggle:hover,
        .lang-toggle:hover {
            background: var(--table-header-bg);
            border-color: var(--table-header-bg);
        }    </style>
    <script>
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeButton(newTheme);
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeButton(savedTheme);
        }

        function updateThemeButton(theme) {
            const button = document.querySelector('.theme-toggle');
            button.textContent = theme === 'dark' ? '⏾' : '☀︎';
        }

        function confirmDelete(nim) {
            const lang = localStorage.getItem('language') || 'id';
            const messages = {
                id: 'Apakah Anda yakin ingin menghapus mahasiswa dengan NIM ',
                en: 'Are you sure you want to delete student with NIM '
            };
            return confirm(messages[lang] + nim + '?');
        }

        const translations = {
            id: {
                title: 'Data Mahasiswa',
                name_placeholder: 'Nama',
                nim_placeholder: 'NIM',
                grade_placeholder: 'Nilai',
                add_student: 'Tambah Mahasiswa',
                student_list: 'Daftar Mahasiswa',
                nim_header: 'NIM',
                name_header: 'Nama',
                grade_header: 'Nilai',
                actions_header: 'Aksi',
                edit: '🖍Edit',
                delete: 'Hapus',
                edit_title: 'Edit Mahasiswa',
                update_student: 'Update Mahasiswa',
                back_to_list: 'Kembali ke Daftar Mahasiswa',
                delete_success: 'berhasil dihapus',
                total_students_prefix: 'Total Mahasiswa: {{.total}}',
                search_text_placeholder: 'Cari NIM atau Nama',
                search_score_placeholder: 'Cari Nilai >',
                search_button: 'Cari',
                clear_search: 'Hapus Pencarian'
            },
            en: {
                title: 'Student Data',
                name_placeholder: 'Name',
                nim_placeholder: 'NIM',
                grade_placeholder: 'Grade',
                add_student: 'Add Student',
                student_list: 'Student List',
                nim_header: 'NIM',
                name_header: 'Name',
                grade_header: 'Grade',
                actions_header: 'Actions',
                edit: '🖍Edit',
                delete: 'Delete',
                edit_title: 'Edit Student',
                update_student: 'Update Student',
                back_to_list: 'Back to Student List',
                delete_success: 'successfully deleted',
                total_students_prefix: 'Total Students: {{.total}}',
                search_text_placeholder: 'Search NIM or Name',
                search_score_placeholder: 'Search Score >',
                search_button: 'Search',
                clear_search: 'Clear Search'
            }
        };

        function toggleLanguage() {
            const currentLang = localStorage.getItem('language') || 'id';
            const newLang = currentLang === 'id' ? 'en' : 'id';
            
            localStorage.setItem('language', newLang);
            applyLanguage(newLang);
            updateLangButton(newLang);
        }

        function cacheOriginalText() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                if (!el.dataset.originalText) {
                    el.dataset.originalText = el.textContent;
        }
    });
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                if (!el.dataset.originalPlaceholder) {
                    el.dataset.originalPlaceholder = el.placeholder || '';
        }
    });
}
        function applyLanguage(lang) {
  const langData = translations[lang] || translations.id;

  // TEXT
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.dataset.i18n;

    if (langData[key]) {
      el.textContent = langData[key];
    } else if (el.dataset.originalText) {
      el.textContent = el.dataset.originalText;
    }
  });

  // PLACEHOLDER
  document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
    const key = el.dataset.i18nPlaceholder;

    if (langData[key]) {
      el.placeholder = langData[key];
    } else if (el.dataset.originalPlaceholder) {
      el.placeholder = el.dataset.originalPlaceholder;
    }
  });

  // Search form elements without data-i18n attributes.
  const searchForm = document.querySelector('form[action="/"]');
  if (searchForm) {
    const searchInput = searchForm.querySelector('input[name="search"]');
    if (searchInput && langData.search_text_placeholder) {
      searchInput.placeholder = langData.search_text_placeholder;
    }
    const scoreInput = searchForm.querySelector('input[name="min_nilai"]');
    if (scoreInput && langData.search_score_placeholder) {
      scoreInput.placeholder = langData.search_score_placeholder;
    }
    const searchButton = searchForm.querySelector('button[type="submit"]');
    if (searchButton && langData.search_button) {
      searchButton.textContent = langData.search_button;
    }
    const clearLink = searchForm.querySelector('a');
    if (clearLink && langData.clear_search) {
      clearLink.textContent = langData.clear_search;
    }
  }
}

        function updateLangButton(lang) {
            const button = document.querySelector('.lang-toggle');
            button.textContent = lang === 'id' ? 'ID' : 'EN';
        }

        function loadLanguage() {
            const savedLang = localStorage.getItem('language') || 'id';
            applyLanguage(savedLang);
            updateLangButton(savedLang);
            
            // Tampilkan pesan sukses jika ada
            showDeleteSuccess();
        }

        function showDeleteSuccess() {
            const urlParams = new URLSearchParams(window.location.search);
            const deleted = urlParams.get('deleted');
            const nim = urlParams.get('nim');
            
            if (deleted === 'true' && nim) {
                const lang = localStorage.getItem('language') || 'id';
                const langData = translations[lang];
                const message = lang === 'id' 
                    ? `Mahasiswa dengan NIM ${nim} ${langData.delete_success}`
                    : `Student with NIM ${nim} ${langData.delete_success}`;
                
                const successDiv = document.getElementById('success-message');
                successDiv.textContent = message;
                successDiv.style.display = 'block';
                
                // Hapus parameter dari URL setelah 3 detik
                setTimeout(() => {
                    const url = new URL(window.location);
                    url.searchParams.delete('deleted');
                    url.searchParams.delete('nim');
                    window.history.replaceState({}, '', url);
                }, 3000);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            cacheOriginalText();
            loadTheme();
            loadLanguage();
        });

        // Also try to load language immediately in case DOMContentLoaded already fired
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                loadTheme();
                loadLanguage();
            });
        } else {
            // DOM already loaded
            loadTheme();
            loadLanguage();
        }

        function sortBy(column) {
            const url = new URL(window.location);
            const currentSortBy = url.searchParams.get('sort_by');
            const currentOrder = url.searchParams.get('order') || 'asc';
            
            let newOrder = 'asc';
            if (currentSortBy === column && currentOrder === 'asc') {
                newOrder = 'desc';  // Toggle ke descending jika kolom sama
            }
            
            url.searchParams.set('sort_by', column);
            url.searchParams.set('order', newOrder);
            
            window.location.href = url.toString();  // Reload halaman dengan sorting baru
        }
    </script>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark/Light Mode">â˜€ï¸</button>
    <button class="lang-toggle" onclick="toggleLanguage()" title="Toggle Language">ðŸ‡®ðŸ‡©</button>
    <h1 data-i18n="title">Data Mahasiswa</h1>
    {{if .error}}
        <p class="error">{{.error}}</p>
    {{end}}
    <div id="success-message" class="success" style="display: none;"></div>
    <form action="/add" method="post">
        <input type="text" name="nama" data-i18n-placeholder="name_placeholder" placeholder="Nama" required>
        <input type="text" name="nim" data-i18n-placeholder="nim_placeholder" placeholder="NIM" required>
        <input type="number" step="0.01" min="0" max="4" name="nilai" data-i18n-placeholder="grade_placeholder" placeholder="Nilai" required>
        <button type="submit" data-i18n="add_student">Tambah Mahasiswa</button>
    </form>
    
    <h2 data-i18n="student_list">Daftar Mahasiswa</h2>
    <form action="/" method="get" style="margin-bottom: 20px;">
        <input type="text" name="search" value="{{.search_text}}" data-i18n-placeholder="search_text_placeholder" placeholder="Cari NIM atau Nama" style="width: 260px; padding: 8px;">
        <input type="number" step="0.01" name="min_nilai" value="{{.min_nilai}}" data-i18n-placeholder="search_score_placeholder" placeholder="Nilai > angka" style="width: 180px; padding: 8px;">
        <button type="submit" data-i18n="search_button">Cari</button>
        {{if or .search_text .min_nilai}}<a href="/" style="margin-left: 10px;" data-i18n="clear_search">Hapus Pencarian</a>{{end}}
    </form>
    <table>
        <thead>
            <tr>
                <th><a href="#" onclick="sortBy('nim')" data-i18n="nim_header">NIM</a> {{if eq .sort_by "nim"}}{{if eq .order "asc"}}⬆{{else}}⬇{{end}}{{end}}</th>
                <th><a href="#" onclick="sortBy('nama')" data-i18n="name_header">Nama</a> {{if eq .sort_by "nama"}}{{if eq .order "asc"}}⬆{{else}}⬇{{end}}{{end}}</th>
                <th><a href="#" onclick="sortBy('nilai')" data-i18n="grade_header">Nilai</a> {{if eq .sort_by "nilai"}}{{if eq .order "asc"}}⬆{{else}}⬇{{end}}{{end}}</th>
                <th data-i18n="actions_header">Aksi</th>
            </tr>
        </thead>
        <tbody>
            {{range .mahasiswa}}
                <tr>
                    <td>{{.NIM}}</td>
                    <td>{{.Nama}}</td>
                    <td>{{.Nilai}}</td>
                    <td>
                        <a href="/edit/{{.ID}}" style="margin-right: 10px;" data-i18n="edit">âœï¸ Edit</a>
                        <form action="/delete" method="post" style="display:inline;">
                            <input type="hidden" name="id" value="{{.ID}}">
                            <button type="submit" onclick="return confirmDelete('{{.NIM}}')" data-i18n="delete">ðŸ—‘ï¸ Hapus</button>
                        </form>
                    </td>
                </tr>
            {{end}}
        </tbody>
    </table>
    <p id="total-students" data-i18n="total_students_prefix">Total Mahasiswa: {{.total}}</p>
</body>
</html>

